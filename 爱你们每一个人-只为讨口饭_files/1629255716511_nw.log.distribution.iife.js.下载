var NWLogDistribution=function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var r,o=t(n((function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}))),a=t(n((function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e},e.exports.default=e.exports,e.exports.__esModule=!0}))),i=new Uint8Array(16);function u(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)}var c=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function s(e){return"string"==typeof e&&c.test(e)}for(var l=[],f=0;f<256;++f)l.push((f+256).toString(16).substr(1));function p(e,t,n){var r=(e=e||{}).random||(e.rng||u)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase();if(!s(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var d=t(n((function(e){function t(n){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0})));"function"==typeof Symbol&&d(Symbol.iterator);var m=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();navigator.userAgent.match(/NEJSBridge\/([\d.]+)\b/);var g=function(){function e(){m(this,e)}return h(e,[{key:"getLegacyProtocolConfig",value:function(e,t){}},{key:"getComputedUrl",value:function(e){return/^[\w0-9]+:\/\//.test(e)?e:this.schemaName_+"://"+e}}]),e}();Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()||Object.assign;var b=function(){var e=function(){var e=navigator.userAgent;if(!e.match(/(iPhone|iPad)/)&&!e.match(/Android/))return!1;var t=null;if(e.match(/(iPhone|iPad)/)?t=e.match(/\bLofter-iPhone ([.0-9]+)\b/i):e.match(/Android/)&&(t=e.match(/\bLofter-android\/([.0-9]+)\b/i)),!t)return!1;var n=t[1].split(".");return{mainVersion:parseInt(n[0],10),subVersion:parseInt(n[1],10)}}();return!!e&&(e.mainVersion>2||2===e.mainVersion&&e.subVersion>=4)},y=function(e){var t=b(),n=void 0,r={},o={};switch(e.path){case"webview":n=1,r.url=e.query.url,e.query.auth&&(r.auth=e.query.auth),e.query.title&&(r.title=e.query.title),o.url=e.query.url}var a="necomics://manhua.163.com/v1";return r.action=n,t?{path:a,query:r}:(o.actionUrl=a+"?"+function(e){if("string"==typeof e)return e;var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+encodeURIComponent(e[t]));return n.join("&")}(r),{path:"shareCallback",query:o})};!function(e){function t(){m(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==d(t)&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.schemaName_="neteaselofter",e}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+d(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(t,e),h(t,[{key:"isInApp",value:function(){return-1!==navigator.userAgent.indexOf("Lofter")}},{key:"getLegacyProtocolConfig",value:function(e,t){switch(e){case"saveShareContent":return{actionName:"saveShareContent",data:t||{}};case"showMenu":return{actionName:"showMenu"};case"hideActionMenu":return{actionName:"hideActionMenu"};case"saveImage":return{actionName:"saveImage",data:t||{}};case"pickAndUploadPhoto":return{actionName:"pickAndUploadPhoto",data:t||null};case"isSupportWXPaySDK":return{actionName:"isSupportWXPaySDK"};case"openSystemConfig":return{actionName:"openSystemConfig"};case"setLofterBackUrl":return{actionName:"setLofterBackUrl",data:t.url?t.url:"https://www.lofter.com/market/fe/home/homePage.html"};case"njb_setPageTitle":return{actionName:"njb_setPageTitle",data:t||{title:"乐乎市集"}};case"refreshMainPageWhenClose":return{actionName:"refreshMainPageWhenClose"};case"triggerLofterPaySDK":return{actionName:"triggerLofterPaySDK",data:t||{}};case"updateCurrentUrl":return{actionName:"updateCurrentUrl",data:t.url?t.url:"https://www.lofter.com/market/fe/home/homePage.html"};case"njb_login":return{actionName:"njb_login",data:{callback:t.callback}};case"njb_updateClient":return{actionName:"njb_updateClient"};case"njb_closeCurrentWebview":return{actionName:"njb_closeCurrentWebview"};case"njb_share":return{actionName:"njb_share",data:t||{}};case"njb_getAppLog":return{actionName:"njb_getAppLog"};case"njb_providePullDownRefresh":return{actionName:"njb_providePullDownRefresh",data:!!t&&t.provide};case"njb_reportLogToApp":return{actionName:"njb_reportLogToApp",data:"["+(t.page?t.page:location.href)+"] "+(t.timing||"")+": "+(t.log||"no log info.")};case"pageRedirect":return{data:y(t)}}}}])}(g);var v=navigator.userAgent;var _=[];var w=function(e){if("string"==typeof e)return e;var t,n=[];for(t in e)e.hasOwnProperty(t)&&n.push(t+"="+encodeURIComponent(e[t]));return n.join("&")},j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},P=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function C(e,t){if(t){var n=document.createElement("iframe");n.style.display="none",n.src=e,document.documentElement.appendChild(n),setTimeout((function(){document.documentElement.removeChild(n)}),0)}else window.location.href=e}var S=function(e,t){e.split(".").reduce((function(e,n,r,o){return r===o.length-1?e[n]=t:void 0!==e[n]&&null!==e[n]||(e[n]={}),e[n]}),window)},N=navigator.userAgent.match(/NEJSBridge\/([\d.]+)\b/),O=!!N,A=O?function(e,t,n){!function(e){if(window.NEJSBridge)e(NEJSBridge);else{_.push(e);var t=!1;document.addEventListener("NEJSBridgeReady",(function(){t=!0,_.forEach((function(e){e(NEJSBridge)})),_=[]}),!1);var n=0;o();var r=setInterval((function(){n<6&&!t?o():clearInterval(r)}),300)}function o(){n++;var e=document.createElement("iframe");e.style.display="none",e.src="nejb://nejb_loaded",document.documentElement.appendChild(e),setTimeout((function(){document.documentElement.removeChild(e)}),0)}}((function(r){r.callHandler(e,t,(function(e){void 0!==e&&(e=JSON.parse(e)),n(e)}))}))}:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"?";"object"===(void 0===n?"undefined":j(n))&&null!==n&&void 0!==n.name&&S(n.name,(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];"function"==typeof n.handler&&n.handler.apply(null,t),S(n.name,null)}));var a=e+o+w(t);C(a,r)},I=function(){function e(){k(this,e)}return P(e,[{key:"getLegacyProtocolConfig",value:function(e,t){}},{key:"getComputedUrl",value:function(e){return/^[\w0-9]+:\/\//.test(e)?e:this.schemaName_+"://"+e}}]),e}(),T=void 0,L=O?function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"?";if(T=T||new e,"pageRedirect"===t){var a=void 0,i=void 0,u=void 0,c=T.getLegacyProtocolConfig(t,n);c?(a=(c=c.data).path||n.path,i=c.query||n.query,void 0!==c.seperator&&(o=c.seperator)):(a=n.path,i=n.query,u=n.close),n={actionUrl:(a=T.getComputedUrl(a))+o+w(i)},u&&(n.close=u)}A(t,n,r)}:function(e,t,n,r,o){var a=(T=T||new e).getLegacyProtocolConfig(t,n)||{};t=a.actionName||t,void 0!==(n=a.data||n).seperator&&(o=n.seperator);var i=null;if(r)if(i={},"string"==typeof a.callback)i.name=a.callback,i.handler=r;else if(void 0!==a.callback){if(void 0===a.callback.name)throw new Error("callback name must be provided");i.name=a.callback.name,i.handler=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if("function"==typeof a.callback.handler){var o=a.callback.handler.apply(null,t);r(o)}else r.apply(null,result)}}var u=T.isInApp();if("pageRedirect"===t){var c=T.getComputedUrl(n.path);A(c,n.query,i,u,o)}else{var s=T.getComputedUrl(t);A(s,n,i,u,o)}};Object.getOwnPropertySymbols,Object.prototype.hasOwnProperty,Object.prototype.propertyIsEnumerable;!function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()||Object.assign;var E={playBackgroundMusic:1,njb_cbShareResult:2,njb_setAutoLoginAccountInfo:3,njb_setPageTitle:4,njb_editor_command:5,njb_editor_status:5,njb_editor_getCaret:5,njb_webview_log:5,njb_getDeviceInfo:6,njb_cbCloseWebview:7,njb_updateClient:7,njb_closeCurrentWebview:7,njb_share:7,njb_getAppLog:7,njb_providePullDownRefresh:7,njb_login:8,njb_check_storage_permission:8,njb_apply_storage_permission:8,njb_reportLogToApp:9,njb_has_applied_unforbid:10,njb_check_notice_permission:11,njb_go_notice_permission:11},D=function(e){return function(e,t){return!(!O||!(e in t))&&t[e]<=parseInt(N[1],10)}(e,E)},x=function(){var e=function(){var e=navigator.userAgent;if(!e.match(/(iPhone|iPad)/)&&!e.match(/Android/))return!1;var t=null;if(e.match(/(iPhone|iPad)/)?t=e.match(/\bLofter-iPhone ([.0-9]+)\b/i):e.match(/Android/)&&(t=e.match(/\bLofter-android\/([.0-9]+)\b/i)),!t)return!1;var n=t[1].split(".");return{mainVersion:parseInt(n[0],10),subVersion:parseInt(n[1],10)}}();return!!e&&(e.mainVersion>2||2===e.mainVersion&&e.subVersion>=4)},B=function(e){var t=x(),n=void 0,r={},o={};switch(e.path){case"webview":n=1,r.url=e.query.url,e.query.auth&&(r.auth=e.query.auth),e.query.title&&(r.title=e.query.title),o.url=e.query.url}var a="necomics://manhua.163.com/v1";return r.action=n,t?{path:a,query:r}:(o.actionUrl=a+"?"+w(r),{path:"shareCallback",query:o})},q=function(e,t,n){var r;r=function(r){r.callHandler(e,t,n)},window.WebViewJavascriptBridge?r(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",(function(){r(WebViewJavascriptBridge)}),!1)},U=function(e){function t(){k(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.schemaName_="neteaselofter",e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),P(t,[{key:"isInApp",value:function(){return-1!==navigator.userAgent.indexOf("Lofter")}},{key:"getLegacyProtocolConfig",value:function(e,t){switch(e){case"saveShareContent":return{actionName:"saveShareContent",data:t||{}};case"showMenu":return{actionName:"showMenu"};case"hideActionMenu":return{actionName:"hideActionMenu"};case"saveImage":return{actionName:"saveImage",data:t||{}};case"pickAndUploadPhoto":return{actionName:"pickAndUploadPhoto",data:t||null};case"isSupportWXPaySDK":return{actionName:"isSupportWXPaySDK"};case"openSystemConfig":return{actionName:"openSystemConfig"};case"setLofterBackUrl":return{actionName:"setLofterBackUrl",data:t.url?t.url:"https://www.lofter.com/market/fe/home/homePage.html"};case"njb_setPageTitle":return{actionName:"njb_setPageTitle",data:t||{title:"乐乎市集"}};case"refreshMainPageWhenClose":return{actionName:"refreshMainPageWhenClose"};case"triggerLofterPaySDK":return{actionName:"triggerLofterPaySDK",data:t||{}};case"updateCurrentUrl":return{actionName:"updateCurrentUrl",data:t.url?t.url:"https://www.lofter.com/market/fe/home/homePage.html"};case"njb_login":return{actionName:"njb_login",data:{callback:t.callback}};case"njb_updateClient":return{actionName:"njb_updateClient"};case"njb_closeCurrentWebview":return{actionName:"njb_closeCurrentWebview"};case"njb_share":return{actionName:"njb_share",data:t||{}};case"njb_getAppLog":return{actionName:"njb_getAppLog"};case"njb_providePullDownRefresh":return{actionName:"njb_providePullDownRefresh",data:!!t&&t.provide};case"njb_reportLogToApp":return{actionName:"njb_reportLogToApp",data:"["+(t.page?t.page:location.href)+"] "+(t.timing||"")+": "+(t.log||"no log info.")};case"pageRedirect":return{data:B(t)}}}}]),t}(I),R=function(e,t,n){!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments[3];"function"==typeof n&&(r=n,n={}),L(e,t,n,r,arguments[4])}(U,e,t,n)},H={ST:"ST",HB:"HB"},M="LOFTER_DEVICE_ID_NEW";function V(e){var t=e.callback,n=e.maxWaitingTime,r=!1,o=function(){r||(r=!0,"function"==typeof t&&t())};return setTimeout(o,void 0===n?200:n),o}var W=function(){function e(t){if(o(this,e),window.HubLogInstance)return window.HubLogInstance;this._userId=t.userId,this._key=t.key,this.__hbInitOptions=t.hbInitOptions||{truncateLength:255,persistence:"localStorage",cross_subdomain_cookie:!0},this._env=t.env,this._k=t.k,this.reloadNum=0,this._initHB(),window.HubLogInstance=this}return a(e,[{key:"_initHB",value:function(){var e=this;if(this._env!==H.ST)if(window.DATracker&&"function"==typeof window.DATracker.trackYueduStatistic)this.promise=new Promise((function(t){window.DATracker.init(e._key,e.__hbInitOptions),e._userId&&window.DATracker.get_user_id()!==e._userId&&window.DATracker.login(e._userId),t()}));else{var t=document.createElement("script");t.setAttribute("src","https://lofter.lf127.net/1629254705681/DATracker.sync._yuedu1.6.12.4.js"),t.setAttribute("type","text/javascript"),t.setAttribute("id","hbEl"),document.head.appendChild(t),this.promise=new Promise((function(n,r){t.onload=function(){window.DATracker.init(e._key,e.__hbInitOptions),e._userId&&window.DATracker.get_user_id()!==e._userId&&window.DATracker.login(e._userId),n()},t.onerror=function(){r("哈勃平台加载失败！")}}))}else this.promise=new Promise((function(e){e()}))}},{key:"_reloadHB",value:function(){var e=document.getElementById("hbEl");e&&e.parentNode.removeChild(e),this._initHB()}},{key:"logToHub",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=V(r);this.promise.then((function(){window.DATracker.trackYueduStatistic(e,t,o)})).catch((function(r){n.reloadNum<3?(n.reloadNum+=1,n._reloadHB(),n.trackByHub(e,t)):(console.log("哈勃平台加载失败!"),n.reloadNum=0)}))}},{key:"trackByHub",value:function(e,t){this.logToHub(e,t)}},{key:"logToSt",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=V(n),o=Object.assign(t,{eId:e,k:this._k,u:this._userId});try{var a=new XMLHttpRequest;a.open("post","https://st.mh.163.com/pc.gif",!0),a.withCredentials=!1,a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.onreadystatechange=function(){4===a.readyState&&(200===a.status?console.log("打点st上报成功"):console.log("打点st服务器错误"),r())},a.send(JSON.stringify(o))}catch(e){console.error(e),console.log("打点st服务器错误"),r()}}},{key:"login",value:function(e){var t=this;this.promise.then((function(){t._env===H.HB&&window.DATracker.login(e),t._userId=e}))}},{key:"logout",value:function(){var e=this;this.promise.then((function(){e._env===H.HB&&window.DATracker.logout(),e._userId=""}))}},{key:"capture",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._env===H.ST?this.logToSt(e,t,n):(this._env,this.logToHub(e,t,n))}},{key:"getDeviceId",value:function(){var e=this;return new Promise((function(t,n){var r=localStorage.getItem(M);r?t(r):(r=p(),localStorage.setItem(M,r),/lofter/i.test(v)?e.promise.then((function(){var e=setTimeout((function(){t(r),e=null}),1e3);D("njb_getDeviceInfo")?function(e,t,n){var r=navigator.userAgent.toLowerCase(),o=r.indexOf("android")>-1,a=r.indexOf("iphone")>-1;try{if(n=n||function(){},0==e.indexOf("njb_")){switch(e){case"njb_reportLogToApp":t={logContent:"["+(t.page?t.page:location.href)+"] "+(t.timing||"")+": "+(t.log||"no log info.")}}R(e,t,n)}else o?("saveShareContent"===e&&"string"!=typeof t&&(t=JSON.stringify(t)),void 0!==t?window.ViewControllerPush[e](t):window.ViewControllerPush[e]()):a&&(r.indexOf("nejsbridge")>-1?R(e,t,n):q(e,t,n))}catch(e){}}("njb_getDeviceInfo",(function(n){n&&n.deviceId&&(localStorage.setItem(M,n.deviceId),e&&(clearTimeout(e),e=null),t(n.deviceId))})):window.DATracker.get_appStatus((function(n){r=n.udid,localStorage.setItem(M,r),e&&(clearTimeout(e),e=null),t(r)}))}),(function(){t(r)})):t(r))}))}}]),e}();return e.APP_KEY={PC:"MA-BFD7-963BF6846668",H5:"MA-B4E8-3BEB9540671E"},e.ENV=H,e.HubLog=W,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
